ns<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome to APIGOAL!</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
	<script type="text/javascript">
  	(function() {
    	emailjs.init("nGUt-2a43ExB954uH"); 
  	})();
	</script>
</head>
<body class="bg-gradient-to-b from-gray-100 to-gray-300 text-gray-900 flex items-center justify-center min-h-screen">

    <div class="bg-white shadow-xl rounded-lg p-8 max-w-md w-full text-center">
        <h1 class="text-2xl font-bold mb-2">🎯 WELCOME TO APIGOAL!</h1>
        
		<!-- Larger green intro box with icon -->
        <div class="bg-green-50 p-4 rounded-lg mb-6 border border-green-200">
            <p class="text-base text-green-700 flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                </svg>
                Please complete this survey to join us. All beta program details in the dashboard after submission. Thank you!
            </p>
            <p class="text-sm text-green-600 mt-2">
            </p>
        </div>

        <form id="survey-form" class="mt-4 text-left">
            <!-- First question - Ranking system with radio buttons -->
            <label class="block text-lg font-semibold mb-2">
                Qualify the importance of the following features (1=high priority, 4=low priority):
            </label>
            
            <!-- Auto Switch -->
            <div class="mb-4 p-2 bg-gray-50 rounded">
                <p class="mb-1 font-medium">Automatic switching to the most cost-effective AI APIs</p>
                <div class="flex flex-wrap gap-4 sm:gap-6">
                    <label class="flex items-center">
                        <input type="radio" name="rank_auto_switch" value="1" class="mr-1">
                        <span>1</span>
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="rank_auto_switch" value="2" class="mr-1">
                        <span>2</span>
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="rank_auto_switch" value="3" class="mr-1">
                        <span>3</span>
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="rank_auto_switch" value="4" class="mr-1">
                        <span>4</span>
                    </label>
                </div>
            </div>
            
            <!-- Cost Comparison -->
            <div class="mb-4 p-2 bg-gray-50 rounded">
                <p class="mb-1 font-medium">Real-time cost comparison with equivalent alternative AI APIs</p>
                <div class="flex flex-wrap gap-4 sm:gap-6">
                    <label class="flex items-center">
                        <input type="radio" name="rank_cost_comparison" value="1" class="mr-1">
                        <span>1</span>
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="rank_cost_comparison" value="2" class="mr-1">
                        <span>2</span>
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="rank_cost_comparison" value="3" class="mr-1">
                        <span>3</span>
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="rank_cost_comparison" value="4" class="mr-1">
                        <span>4</span>
                    </label>
                </div>
            </div>
            
            <!-- Cost Monitoring -->
            <div class="mb-4 p-2 bg-gray-50 rounded">
                <p class="mb-1 font-medium">Real-time monitoring of overall and analytical AI API costs</p>
                <div class="flex flex-wrap gap-4 sm:gap-6">
                    <label class="flex items-center">
                        <input type="radio" name="rank_cost_monitoring" value="1" class="mr-1">
                        <span>1</span>
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="rank_cost_monitoring" value="2" class="mr-1">
                        <span>2</span>
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="rank_cost_monitoring" value="3" class="mr-1">
                        <span>3</span>
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="rank_cost_monitoring" value="4" class="mr-1">
                        <span>4</span>
                    </label>
                </div>
            </div>
            
            <!-- Efficiency/Security Monitoring -->
            <div class="mb-4 p-2 bg-gray-50 rounded">
                <p class="mb-1 font-medium">Real-time monitoring of AI API efficiency and security</p>
                <div class="flex flex-wrap gap-4 sm:gap-6">
                    <label class="flex items-center">
                        <input type="radio" name="rank_efficiency_security" value="1" class="mr-1">
                        <span>1</span>
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="rank_efficiency_security" value="2" class="mr-1">
                        <span>2</span>
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="rank_efficiency_security" value="3" class="mr-1">
                        <span>3</span>
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="rank_efficiency_security" value="4" class="mr-1">
                        <span>4</span>
                    </label>
                </div>
            </div>

            <!-- New question about AI API providers -->
            <label class="block text-lg font-semibold mb-2">
                Which AI API providers are you currently using? (Select all that apply)
            </label>
            <div class="mb-4 space-y-2">
                <label class="flex items-center">
                    <input type="checkbox" name="providers" value="openai" class="mr-2">
                    OpenAI (GPT models)
                </label>
                <label class="flex items-center">
                    <input type="checkbox" name="providers" value="anthropic" class="mr-2">
                    Anthropic (Claude models)
                </label>
                <label class="flex items-center">
                    <input type="checkbox" name="providers" value="google" class="mr-2">
                    Google (Gemini models)
                </label>
                <label class="flex items-center">
                    <input type="checkbox" name="providers" value="deepseek" class="mr-2">
                    DeepSeek
                </label>
                <label class="flex items-center">
                    <input type="checkbox" name="providers" value="ngrok" class="mr-2">
                    Ngrok
                </label>

		<label class="flex items-center">
                    <input type="checkbox" name="providers" value="mistral" class="mr-2">
                    Mistral AI
                </label>

                <label class="flex items-center">
                    <input type="checkbox" name="providers" value="other" class="mr-2">
                    Other (please specify in the comments)
                </label>
            </div>

            <!-- Simplified monthly budget question -->
            <label class="block text-lg font-semibold mb-2">
                What is your current monthly budget for AI APIs?
            </label>
            <div class="mb-4">
                <label class="flex items-center">
                    <input type="radio" name="budget" value="under_100" class="mr-2">
                    Under $100
                </label>
                <label class="flex items-center">
                    <input type="radio" name="budget" value="100_1000" class="mr-2">
                    $100 - $1,000
                </label>
                <label class="flex items-center">
                    <input type="radio" name="budget" value="1000_plus" class="mr-2">
                    Over $1,000
                </label>
            </div>

            <!-- New question about usage type -->
            <label class="block text-lg font-semibold mb-2">
                What are your primary AI API use cases? (Select all that apply)
            </label>
            <div class="mb-4 space-y-2">
                <label class="flex items-center">
                    <input type="checkbox" name="use_cases" value="text_generation" class="mr-2">
                    Text generation/completion
                </label>
                <label class="flex items-center">
                    <input type="checkbox" name="use_cases" value="embeddings" class="mr-2">
                    Embeddings/Vector operations
                </label>
                <label class="flex items-center">
                    <input type="checkbox" name="use_cases" value="image_generation" class="mr-2">
                    Image generation
                </label>
                <label class="flex items-center">
                    <input type="checkbox" name="use_cases" value="analysis" class="mr-2">
                    Content analysis/moderation
                </label>
                <label class="flex items-center">
                    <input type="checkbox" name="use_cases" value="other" class="mr-2">
                    Other (please specify in comments)
                </label>
            </div>

            <!-- Second original question -->
            <label class="block text-lg font-semibold mb-2">
                Select your preferences:
            </label>
            <div class="mb-4">
                <label class="block text-md font-medium mb-1">Dashboard presentation:</label>
                <label class="flex items-center">
                    <input type="radio" name="dashboard_option" value="dashboard_only" class="mr-2">
                    Dashboard only
                </label>
                <label class="flex items-center">
                    <input type="radio" name="dashboard_option" value="dashboard_widgets" class="mr-2">
                    Dashboard + widgets
                </label>
            </div>
            <div class="mb-4">
                <label class="block text-md font-medium mb-1">Usage type:</label>
                <label class="flex items-center">
                    <input type="radio" name="usage_option" value="individuals" class="mr-2">
                    For individual professionals
                </label>
                <label class="flex items-center">
                    <input type="radio" name="usage_option" value="teams" class="mr-2">
                    For teams
                </label>
            </div>

            <!-- Third item - optional comments -->
            <label class="block text-lg font-semibold mb-2">
                Let us know what interests you most about the service (specific cost optimization needs, security requirements, switching concerns, etc.):
            </label>
		<textarea id="custom_request" name="custom_request" class="w-full p-2 border 			rounded-lg mt-1 mb-4" 
          	placeholder="Write here (optional)..."></textarea>

            <!-- Contact message -->
            <p class="text-sm text-gray-600 mb-4">
                Feel free to contact us at <a href="mailto:info@apigoal.com" class="text-blue-600 underline">info@apigoal.com</a> for any requests.  
                Thank you for your availability!
            </p>

		<div class="mb-4 flex items-start space-x-2">
		  <input type="checkbox" id="disclaimer_check" class="mt-1" required>
		  <label for="disclaimer_check" class="text-sm">
		    I have read and accept the conditions of the
		    <button type="button" id="openDisclaimer" class="text-blue-600 underline font-medium">
		      APIGOAL Beta Version Disclaimer
		    </button>
		  </label>
		</div>
		
				
            <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700">
                Join APIGOAL Beta-Dashboard
            </button>
        </form>
	    
	<!-- Disclaimer Modal -->
	<div id="disclaimerModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
	  <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full p-6 relative overflow-y-auto max-h-[90vh]">
	
	    <!-- Close button -->
	    <button id="closeDisclaimer" class="absolute top-2 right-3 text-gray-500 hover:text-black text-xl font-bold">&times;</button>
	
	    <h2 class="text-xl font-bold text-center text-blue-700 mb-4">APIGOAL – Beta Version Disclaimer</h2>
	
	    <div class="text-sm space-y-2">
	      <p>This version is under active development and is provided step by step “as is”, without any express or implied warranties. The application may contain bugs, errors, or incomplete features. By using this beta version, you agree to the following terms:</p>
	
	      <ul class="list-disc list-inside pl-4 space-y-1">
	        <li><strong>Use at your own risk</strong>: We disclaim any liability for data loss, service interruptions, or other malfunctions.</li>
	        <li><strong>Data collection</strong>: We may collect data about your interactions to improve the service. No sensitive information will be stored or shared.</li>
	        <li><strong> Feedback and suggestions</strong>: Your feedback and suggestions may be freely used to improve the app.</li>
	        <li><strong>Confidentiality</strong>: Do not publicly share technical details or code without permission.</li>
	        <li><strong>Changes and suspension</strong>: Access may be suspended or terminated with prior notice sent to the email address provided.</li>
	      </ul>
	    </div>
	
	    <div class="mt-6 text-center">
	      <button id="closeDisclaimerBottom" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
	        Close
	      </button>
	    </div>
	  </div>
	</div>
	    
    </div>

<script>
document.addEventListener("DOMContentLoaded", async function() {
    console.log("📌 Document loaded. Initializing Supabase...");

    // Immediately block access if Supabase is not loaded
    if (typeof supabase === 'undefined') {
        console.error("❌ Supabase library not loaded.");
        document.body.innerHTML = `
            <div style="display:flex; justify-content:center; align-items:center; height:100vh; background-color:#f5f5f5;">
                <div style="padding:20px; background-color:white; border-radius:8px; box-shadow:0 4px 8px rgba(0,0,0,0.1); text-align:center; max-width:400px;">
                    <h2 style="color:#e53e3e; margin-bottom:16px;">Access Denied</h2>
                    <p style="margin-bottom:16px;">Authentication system not available. Please try again later.</p>
                    <a href="https://apigoal.com/index.html" style="display:inline-block; background-color:#3182ce; color:white; padding:8px 16px; border-radius:4px; text-decoration:none;">Go to Homepage</a>
                </div>
            </div>
        `;
        return;
    }

    const supabaseUrl = 'https://wenndkgeebooikzikhew.supabase.co';
    const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Indlbm5ka2dlZWJvb2lremlraGV3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDIwMjk0NjUsImV4cCI6MjA1NzYwNTQ2NX0.4_Pnkffn1mPUkHyYfk6bDmdWk2L14LTV5hEEvDaWu8c';

    const supabaseClient = supabase.createClient(supabaseUrl, supabaseAnonKey);
    console.log("✅ Supabase client initialized:", supabaseClient);

    // Check user authentication before performing any other operation
    try {
        console.log("🔍 Checking user authentication...");
        const { data: { user }, error } = await supabaseClient.auth.getUser();

        // Mostra l'accesso negato se c'è un errore, o l'utente non esiste, o non ha confermato l'email
        if (error || !user || !user.last_sign_in_at) {
            console.warn("🚫 No verified user logged in. Blocking access...");
            document.body.innerHTML = `
                <div style="display:flex; justify-content:center; align-items:center; height:100vh; background-color:#f5f5f5;">
                    <div style="padding:20px; background-color:white; border-radius:8px; box-shadow:0 4px 8px rgba(0,0,0,0.1); text-align:center; max-width:400px;">
                        <h2 style="color:#e53e3e; margin-bottom:16px;">Access Denied</h2>
                        <p style="margin-bottom:16px;">You must log in and verify your account to access this page.</p>
                        <a href="https://apigoal.com/index.html" style="display:inline-block; background-color:#3182ce; color:white; padding:8px 16px; border-radius:4px; text-decoration:none;">Go to Homepage</a>
                    </div>
                </div>
            `;
            // Important: completely stops execution of the remaining code
            return;
        }

        console.log("✅ User found:", user);

        // Continue checking survey status only if the user is authenticated
        const { data, error: surveyError } = await supabaseClient
            .from('beta_survey')
            .select('*')
            .eq('user_id', user.id);

        if (surveyError) {
            console.error("⚠️ Failed to fetch survey data:", surveyError);
            return;
        }

        console.log("📊 Survey data:", data);

        if (data.length > 0) {
            console.log("🔄 User already completed survey, redirecting...");
            window.location.href = "https://apigoal.com/beta_dashboard";
            return;
        }
    } catch (error) {
        console.error("❌ Authentication Check Error:", error);
        document.body.innerHTML = `
            <div style="display:flex; justify-content:center; align-items:center; height:100vh; background-color:#f5f5f5;">
                <div style="padding:20px; background-color:white; border-radius:8px; box-shadow:0 4px 8px rgba(0,0,0,0.1); text-align:center; max-width:400px;">
                    <h2 style="color:#e53e3e; margin-bottom:16px;">Error</h2>
                    <p style="margin-bottom:16px;">An error occurred while checking your access. Please try again later.</p>
                    <a href="https://apigoal.com/index.html" style="display:inline-block; background-color:#3182ce; color:white; padding:8px 16px; border-radius:4px; text-decoration:none;">Go to Homepage</a>
                </div>
            </div>
        `;
        return;
    }

    // The rest of the code will only run if the user is authenticated and verified
    
    // Disclaimer modal logic
    document.getElementById("openDisclaimer").addEventListener("click", function () {
        document.getElementById("disclaimerModal").classList.remove("hidden");
    });

    document.getElementById("closeDisclaimer").addEventListener("click", function () {
        document.getElementById("disclaimerModal").classList.add("hidden");
    });

    document.getElementById("closeDisclaimerBottom").addEventListener("click", function () {
        document.getElementById("disclaimerModal").classList.add("hidden");
    });

	// Survey form submit
	document.getElementById("survey-form").addEventListener("submit", async function(event) {
	    event.preventDefault();
	
	    const { data: { user }, error } = await supabaseClient.auth.getUser();
	    if (!user) {
	        alert("Error: User not logged in. Please refresh the page.");
	        return;
	    }
	
	    const rankAutoSwitch = document.querySelector('input[name="rank_auto_switch"]:checked')?.value || null;
	    const rankCostComparison = document.querySelector('input[name="rank_cost_comparison"]:checked')?.value || null;
	    const rankCostMonitoring = document.querySelector('input[name="rank_cost_monitoring"]:checked')?.value || null;
	    const rankEfficiencySecurity = document.querySelector('input[name="rank_efficiency_security"]:checked')?.value || null;
	    const budget = document.querySelector('input[name="budget"]:checked')?.value || null;
	    const dashboardOption = document.querySelector('input[name="dashboard_option"]:checked')?.value || null;
	    const usageOption = document.querySelector('input[name="usage_option"]:checked')?.value || null;
	    const customRequest = document.getElementById("custom_request").value.trim();
	    const selectedProviders = Array.from(document.querySelectorAll('input[name="providers"]:checked')).map(input => input.value);
	    const selectedUseCases = Array.from(document.querySelectorAll('input[name="use_cases"]:checked')).map(input => input.value);
	
	    if (!rankAutoSwitch || !rankCostComparison || !rankCostMonitoring || !rankEfficiencySecurity) {
	        alert("⚠️ Please rank all features before submitting.");
	        return;
	    }
	
	    const disclaimerAccepted = document.getElementById("disclaimer_check").checked;
	    if (!disclaimerAccepted) {
	        alert("⚠️ You must accept the APIGOAL Beta Disclaimer to continue.");
	        return;
	    }
	
	    if (!budget) {
	        alert("⚠️ Please select your monthly AI API budget.");
	        return;
	    }
	
	    if (selectedProviders.length === 0) {
	        alert("⚠️ Please select at least one AI API provider.");
	        return;
	    }
	
	    if (selectedUseCases.length === 0) {
	        alert("⚠️ Please select at least one use case.");
	        return;
	    }
	
	    try {
	        const { error } = await supabaseClient
	            .from('beta_survey')
	            .insert([{
	                user_id: user.id,
	                rank_auto_switch: rankAutoSwitch,
	                rank_cost_comparison: rankCostComparison,
	                rank_cost_monitoring: rankCostMonitoring,
	                rank_efficiency_security: rankEfficiencySecurity,
	                budget: budget,
	                dashboard_option: dashboardOption,
	                usage_option: usageOption,
	                custom_request: customRequest,
	                providers: selectedProviders,
	                use_cases: selectedUseCases
	            }]);
	
	        if (error) {
	            console.error("❌ Survey Error:", error);
	            alert("Error submitting survey. Try again.");
	        } else {
	            // Sending email via EmailJS and redirecting only after email has been sent
	            emailjs.send("service_t0omkv5", "template_wsinzl8", {
	                to_email: user.email,
	                email: user.email
	            })
	            .then((response) => {
	                console.log("📧 EmailJS success:", response.status, response.text);
	                window.location.href = "https://apigoal.com/beta_dashboard";
	            })
	            .catch((error) => {
	                console.error("❌ EmailJS error:", JSON.stringify(error));
	                alert("⚠️ Error sending confirmation email. Please contact support.");
	                window.location.href = "https://apigoal.com/beta_dashboard";
	            });
	        }
	    } catch (error) {
	        console.error("❌ Network Error submitting survey:", error);
	        alert("Network error. Please try again later.");
	    }
	}); // Closing submit event listener
	
	}); // Closing DOMContentLoaded
</script>

</body>
</html>
